我們定義以下 5+ 個核心功能模組，這些模組的設計目的是為了產出高 WMC 與高測試覆蓋率。

### F1: 核心規則引擎 (Core Rule Engine) - *專案心臟*
* **描述**: 負責處理麻將的所有數學與邏輯判斷。
* **細項**:
    1.  **牌山管理**: 洗牌、發牌、流局判定。
    2.  **合法性驗證 (Validator)**: 判斷玩家是否可以吃、碰、槓（例如：只能吃上家的牌）。
    3.  **胡牌演算法 (Win Strategy)**: 這是 WMC 的主要來源。需實作 Backtracking 或遞迴算法來判斷 `m*AAA + n*ABC + DD` 牌型。
* **測試重點**: 100% 邏輯覆蓋，包含各種邊界牌型（如：九蓮寶燈、十三么的特殊判定若有實作）。

### F2: 連線大廳與配對 (Lobby & Matchmaking)
* **描述**: 管理 Client 與 Server 的連線生命週期。
* **細項**:
    1.  建立房間 (Host Game)。
    2.  加入房間 (Join Game by IP)。
    3.  斷線偵測與簡易重連 (若時間允許)。
* **測試重點**: 使用 Mock Socket 測試伺服器對多客戶端的併發處理。

### F3: 遊戲狀態同步 (State Synchronization)
* **描述**: Server 維護「真理 (Source of Truth)」，並將狀態廣播給所有 Clients。
* **細項**:
    1.  定義通訊協議 (Protocol): 如 JSON 字串或 Java Serializable Object。
    2.  廣播事件: `PLAYER_ACTION` (吃碰槓), `GAME_START`, `GAME_OVER`。
    3.  輪次管理: 控制當前由誰出牌 (Active Player)。

### F4: 台數計算機 (Scoring Calculator)
* **描述**: 胡牌後的計分邏輯。
* **細項**:
    1.  判斷台數：碰碰胡、清一色、混一色、風牌、三元牌等。
    2.  計算總分：底 + 台數 * 係數。
* **測試重點**: 提供多種牌型組合，驗證算分準確性 (Parameterised Tests)。

### F5: 圖形使用者介面 (GUI)
* **描述**: 玩家操作介面。
* **細項**:
    1.  顯示手牌、棄牌區 (River)、其他玩家狀態。
    2.  互動按鈕：吃、碰、槓、胡、放棄。
* **限制**: UI 類別不包含任何遊戲規則邏輯。

### F6: 測試數據生成器 (Test Data Generator)
* **描述**: 為了滿足「測試設計」要求，建立一個工具能快速生成特定的牌局情境（例如：直接生成一個聽牌狀態），用於展示 Demo 和自動化測試。

## 3. 專案限制與指標 (Constraints & Metrics)
* **WMC (總複雜度)**: > 200 (主要由 F1 和 F4 貢獻)。
* **單元測試數**: >= 50 個 (針對 F1, F2, F3, F4)。
* **Branch Coverage**: >= 90% (排除 UI 類別後的邏輯代碼)。

## 4. 規則簡化聲明 (Scope Limitation)
為了在有限時間內完成並確保高品質測試：
* 採用 **「台灣 16 張麻將」** 基礎規則。
* **不實作**：花牌（春夏秋冬）、複雜的特殊役種（如天胡地胡可選做）、抓位（固定位置）。
* 重點在於「吃碰槓胡」的互動邏輯正確性。